<div class="gestion-categorias">
  <div class="header-gestion">
    <h1>ğŸ—‚ï¸ GestiÃ³n de CategorÃ­as del MenÃº</h1>
    <div class="acciones-header">
      <button class="btn-agregar" (click)="mostrarFormCategoria = true">
        â• Nueva CategorÃ­a
      </button>
      <button class="btn-restaurar" (click)="confirmarRestaurar()">
        ğŸ”„ Restaurar Predeterminadas
      </button>
    </div>
  </div>

  <!-- FORMULARIO NUEVA CATEGORÃA -->
  <div class="modal" *ngIf="mostrarFormCategoria">
    <div class="modal-contenido">
      <h3>Nueva CategorÃ­a Principal</h3>
      <input 
        type="text" 
        [(ngModel)]="nuevaCategoriaNombre" 
        placeholder="Nombre de la categorÃ­a"
        class="input-nombre">
      <div class="modal-acciones">
        <button class="btn-cancelar" (click)="cancelarFormCategoria()">Cancelar</button>
        <button class="btn-guardar" (click)="guardarCategoria()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- LISTA DE CATEGORÃAS -->
  <div class="categorias-lista">
    <div class="categoria-card" *ngFor="let categoria of categorias">
      
      <!-- HEADER DE LA CATEGORÃA -->
      <div class="categoria-header" [class.categoria-oculta]="!categoria.visible">
        <div class="categoria-info">
          <span class="categoria-icono">{{ categoria.visible ? 'ğŸ‘ï¸' : 'ğŸš«' }}</span>
          <h2>{{ categoria.nombre }}</h2>
          <span class="badge-subcategorias">
            {{ categoria.subcategorias.length }} subcategorÃ­as
          </span>
        </div>
        
        <div class="categoria-acciones">
          <button 
            class="btn-icono btn-editar" 
            (click)="editarCategoria(categoria)"
            title="Editar">
            âœï¸
          </button>
          <button 
            class="btn-icono btn-toggle" 
            (click)="toggleCategoria(categoria.id)"
            [title]="categoria.visible ? 'Ocultar' : 'Mostrar'">
            {{ categoria.visible ? 'ğŸ‘ï¸' : 'ğŸ”’' }}
          </button>
          <button 
            class="btn-icono btn-eliminar" 
            (click)="confirmarEliminarCategoria(categoria)"
            title="Eliminar">
            ğŸ—‘ï¸
          </button>
          <button 
            class="btn-icono btn-agregar-sub" 
            (click)="mostrarFormSubcategoria(categoria.id)"
            title="Agregar subcategorÃ­a">
            â•
          </button>
        </div>
      </div>

      <!-- SUBCATEGORÃAS -->
      <div class="subcategorias-lista" *ngIf="categoria.subcategorias.length > 0">
        <div 
          class="subcategoria-item" 
          *ngFor="let sub of categoria.subcategorias"
          [class.subcategoria-oculta]="!sub.visible">
          
          <span class="sub-icono">{{ sub.visible ? 'â–ªï¸' : 'âš«' }}</span>
          <span class="sub-nombre">{{ sub.nombre }}</span>
          
          <div class="sub-acciones">
            <button 
              class="btn-icono-small btn-editar" 
              (click)="editarSubcategoria(categoria.id, sub)"
              title="Editar">
              âœï¸
            </button>
            <button 
              class="btn-icono-small btn-toggle" 
              (click)="toggleSubcategoria(categoria.id, sub.id)"
              [title]="sub.visible ? 'Ocultar' : 'Mostrar'">
              {{ sub.visible ? 'ğŸ‘ï¸' : 'ğŸ”’' }}
            </button>
            <button 
              class="btn-icono-small btn-eliminar" 
              (click)="confirmarEliminarSubcategoria(categoria.id, sub)"
              title="Eliminar">
              ğŸ—‘ï¸
            </button>
          </div>
        </div>
      </div>

      <!-- FORMULARIO NUEVA SUBCATEGORÃA -->
      <div class="form-subcategoria" *ngIf="subcategoriaFormCategoriaId === categoria.id">
        <input 
          type="text" 
          [(ngModel)]="nuevaSubcategoriaNombre" 
          placeholder="Nombre de la subcategorÃ­a"
          class="input-subcategoria">
        <button class="btn-cancelar-small" (click)="cancelarFormSubcategoria()">âœ–</button>
        <button class="btn-guardar-small" (click)="guardarSubcategoria(categoria.id)">âœ”</button>
      </div>
    </div>
  </div>

  <!-- MODAL EDITAR CATEGORÃA -->
  <div class="modal" *ngIf="categoriaEditando">
    <div class="modal-contenido">
      <h3>Editar CategorÃ­a</h3>
      <input 
        type="text" 
        [(ngModel)]="categoriaEditando.nombre" 
        class="input-nombre">
      <div class="modal-acciones">
        <button class="btn-cancelar" (click)="cancelarEdicionCategoria()">Cancelar</button>
        <button class="btn-guardar" (click)="confirmarEdicionCategoria()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL EDITAR SUBCATEGORÃA -->
  <div class="modal" *ngIf="subcategoriaEditando">
    <div class="modal-contenido">
      <h3>Editar SubcategorÃ­a</h3>
      <input 
        type="text" 
        [(ngModel)]="subcategoriaEditando.nombre" 
        class="input-nombre">
      <div class="modal-acciones">
        <button class="btn-cancelar" (click)="cancelarEdicionSubcategoria()">Cancelar</button>
        <button class="btn-guardar" (click)="confirmarEdicionSubcategoria()">Guardar</button>
      </div>
    </div>
  </div>

  <!-- MODAL CONFIRMACIÃ“N -->
  <div class="modal" *ngIf="confirmacion">
    <div class="modal-contenido modal-confirmacion">
      <h3>âš ï¸ {{ confirmacion.titulo }}</h3>
      <p>{{ confirmacion.mensaje }}</p>
      <div class="modal-acciones">
        <button class="btn-cancelar" (click)="cancelarConfirmacion()">Cancelar</button>
        <button class="btn-eliminar-confirmar" (click)="ejecutarConfirmacion()">
          {{ confirmacion.botonTexto }}
        </button>
      </div>
    </div>
  </div>
</div>