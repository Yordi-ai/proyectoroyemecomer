<!-- CONTENEDOR PRINCIPAL -->
<div class="admin-container">
  
  <!-- SIDEBAR / NAVEGACI√ìN -->
  <aside class="admin-sidebar">
    <div class="sidebar-header">
      <h2>üõ†Ô∏è ADMIN PANEL</h2>
      <p class="admin-name">{{ nombreAdmin }}</p>
    </div>

    <nav class="sidebar-nav">
      <button 
        class="nav-item" 
        [class.active]="vistaActual === 'productos'"
        (click)="cambiarVista('productos')">
        <span class="nav-icon">üì¶</span>
        <span>Productos</span>
      </button>

      <button 
        class="nav-item" 
        [class.active]="vistaActual === 'pedidos'"
        (click)="cambiarVista('pedidos')">
        <span class="nav-icon">üõí</span>
        <span>Pedidos</span>
      </button>

      <button 
        class="nav-item" 
        [class.active]="vistaActual === 'usuarios'"
        (click)="cambiarVista('usuarios')">
        <span class="nav-icon">üë•</span>
        <span>Usuarios</span>
      </button>

      <!-- ‚úÖ NUEVO BOT√ìN - GESTIONAR CATEGOR√çAS -->
      <button 
        class="nav-item" 
        routerLink="/admin/categorias">
        <span class="nav-icon">üóÇÔ∏è</span>
        <span>Categor√≠as</span>
      </button>

      <button 
        class="nav-item" 
        [class.active]="vistaActual === 'estadisticas'"
        (click)="cambiarVista('estadisticas')">
        <span class="nav-icon">üìä</span>
        <span>Estad√≠sticas</span>
      </button>
    </nav>

    <div class="sidebar-footer">
      <button class="btn-logout" (click)="cerrarSesion()">
        üö™ Cerrar Sesi√≥n
      </button>
    </div>
  </aside>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="admin-content">

    <!-- ============== VISTA DE PRODUCTOS ============== -->
    <div *ngIf="vistaActual === 'productos'" class="vista-productos">
      
      <!-- HEADER CON ESTAD√çSTICAS -->
      <div class="content-header">
        <div class="header-info">
          <h1>üì¶ Gesti√≥n de Productos</h1>
          <p>Administra el cat√°logo de productos de ROYEM S.A.C.</p>
        </div>
        <button class="btn-primary" (click)="mostrarFormularioNuevo()">
          ‚ûï Nuevo Producto
        </button>
      </div>

      <!-- CARDS DE ESTAD√çSTICAS -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üì¶</div>
          <div class="stat-info">
            <p class="stat-label">Total Productos</p>
            <p class="stat-value">{{ estadisticas.totalProductos }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-info">
            <p class="stat-label">En Stock</p>
            <p class="stat-value">{{ productosConStock }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">‚ö†Ô∏è</div>
          <div class="stat-info">
            <p class="stat-label">Stock Bajo</p>
            <p class="stat-value">{{ productosStockBajo }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon">üè∑Ô∏è</div>
          <div class="stat-info">
            <p class="stat-label">Categor√≠as</p>
            <p class="stat-value">{{ categorias.length }}</p>
          </div>
        </div>
      </div>

      <!-- B√öSQUEDA Y FILTROS -->
      <div class="filters-section">
        <div class="search-box">
          <input 
            type="text" 
            [ngModel]="terminoBusqueda"
            (input)="onSearchChange($any($event.target).value)"
            placeholder="üîç Buscar productos..."
            class="search-input">
        </div>

        <select 
          [(ngModel)]="categoriaFiltro"
          (ngModelChange)="filtrarProductos()"
          class="filter-select">
          <option value="">üìÇ Todas las categor√≠as</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>
      </div>

      <!-- LOADING -->
      <div *ngIf="cargando" class="loading-container">
        <div class="spinner"></div>
        <p>Cargando productos...</p>
      </div>

      <!-- TABLA DE PRODUCTOS -->
      <div *ngIf="!cargando" class="table-container">
        <table class="productos-table">
          <thead>
            <tr>
              <th>Imagen</th>
              <th>Producto</th>
              <th>Categor√≠a</th>
              <th>Precio</th>
              <th>Stock</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let producto of productosFiltrados; trackBy: trackByProductoId">
              <td>
                <div class="img-container">
                  <img 
                    [src]="producto.imagenUrl || 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2260%22 height=%2260%22%3E%3Crect width=%2260%22 height=%2260%22 fill=%22%23f0f0f0%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-size=%2210%22 fill=%22%23999%22%3ESin%3C/text%3E%3Ctext x=%2250%25%22 y=%2270%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial%22 font-size=%2210%22 fill=%22%23999%22%3EImagen%3C/text%3E%3C/svg%3E'" 
                    [alt]="producto.nombre"
                    class="producto-img"
                    loading="lazy">
                </div>
              </td>
              <td>
                <div class="producto-info">
                  <p class="producto-nombre">{{ producto.nombre }}</p>
                  <p class="producto-desc">{{ producto.descripcion }}</p>
                </div>
              </td>
              <td>
                <span class="badge badge-categoria">{{ producto.categoria }}</span>
              </td>
              <td class="precio">S/ {{ producto.precio | number:'1.2-2' }}</td>
              <td>
                <span 
                  class="badge"
                  [class.badge-success]="producto.stock > 10"
                  [class.badge-warning]="producto.stock > 0 && producto.stock <= 10"
                  [class.badge-danger]="producto.stock === 0">
                  {{ producto.stock }} unidades
                </span>
              </td>
              <td>
                <div class="action-buttons">
                  <button 
                    class="btn-icon btn-edit" 
                    (click)="editarProducto(producto)"
                    title="Editar">
                    ‚úèÔ∏è
                  </button>
                  <button 
                    class="btn-icon btn-delete" 
                    (click)="eliminarProducto(producto.id)"
                    title="Eliminar">
                    üóëÔ∏è
                  </button>
                </div>
              </td>
            </tr>

            <tr *ngIf="productosFiltrados.length === 0">
              <td colspan="6" class="no-data">
                <p>No se encontraron productos</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>

 
    <!-- ============== VISTA DE ESTAD√çSTICAS ============== -->
    <div *ngIf="vistaActual === 'estadisticas'" class="vista-estadisticas">
      <div class="content-header">
        <h1>üìä Estad√≠sticas del Sistema</h1>
      </div>
      <div class="placeholder-content">
        <p>Dashboard de estad√≠sticas en desarrollo...</p>
        <p>Aqu√≠ ver√°s gr√°ficos y m√©tricas del negocio</p>
      </div>
    </div>

  </main>

</div>

<!-- ============== MODAL FORMULARIO DE PRODUCTO ============== -->
<div *ngIf="mostrarFormulario" class="modal-overlay" (click)="cancelar()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    
    <!-- HEADER DEL MODAL -->
    <div class="modal-header">
      <h2>{{ modoEdicion ? '‚úèÔ∏è Editar Producto' : '‚ûï Nuevo Producto' }}</h2>
      <button class="btn-close" (click)="cancelar()">‚úï</button>
    </div>

    <!-- BODY DEL MODAL -->
    <div class="modal-body">
      <form class="producto-form">
        
        <!-- IMAGEN -->
        <div class="form-group full-width">
          <label>Imagen del Producto</label>
          
          <div class="image-upload-area">
            <div class="image-preview" *ngIf="imagenPreview">
              <img [src]="imagenPreview" alt="Preview">
            </div>
            
            <div class="upload-placeholder" *ngIf="!imagenPreview">
              <span class="upload-icon">üñºÔ∏è</span>
              <p>Arrastra una imagen o haz clic para seleccionar</p>
            </div>
            
            <input 
              type="file" 
              accept="image/*"
              (change)="onFileSelected($event)"
              class="file-input"
              id="fileInput">
            
            <label for="fileInput" class="btn-upload">
              üìÅ Seleccionar Imagen
            </label>
          </div>
        </div>

        <!-- NOMBRE -->
        <div class="form-group">
          <label>Nombre *</label>
          <input 
            type="text" 
            [(ngModel)]="nuevoProducto.nombre"
            name="nombre"
            placeholder="Nombre del producto"
            class="form-input"
            required>
        </div>

        <!-- CATEGOR√çA -->
        <div class="form-group">
          <label>Categor√≠a * <span class="campo-obligatorio">(Obligatorio)</span></label>
          <select 
            [(ngModel)]="nuevoProducto.categoria"
            name="categoria"
            class="form-input form-select"
            required>
            <option value="">-- Seleccione una categor√≠a --</option>
            
            <!-- ü¶∫ SEGURIDAD INDUSTRIAL -->
            <optgroup label="ü¶∫ SEGURIDAD INDUSTRIAL">
              <option value="Protecci√≥n de pies">Protecci√≥n de pies</option>
              <option value="Protecci√≥n de manos">Protecci√≥n de manos</option>
              <option value="Protecci√≥n corporal">Protecci√≥n corporal</option>
              <option value="Protecci√≥n antica√≠da">Protecci√≥n antica√≠da</option>
              <option value="Protecci√≥n auditiva">Protecci√≥n auditiva</option>
              <option value="Protecci√≥n respiratoria">Protecci√≥n respiratoria</option>
              <option value="Protecci√≥n de cabeza, visual y facial">Protecci√≥n de cabeza, visual y facial</option>
              <option value="Ropa de trabajo">Ropa de trabajo</option>
              <option value="Bloqueo y etiquetado">Bloqueo y etiquetado</option>
              <option value="Pa√±os de seguridad industrial">Pa√±os de seguridad industrial</option>
              <option value="Se√±alizaci√≥n">Se√±alizaci√≥n</option>
              <option value="Emergencia y primeros auxilios">Emergencia y primeros auxilios</option>
              <option value="Protecci√≥n solar">Protecci√≥n solar</option>
            </optgroup>
            
            <!-- ‚ö° EL√âCTRICOS E INSTRUMENTACI√ìN -->
            <optgroup label="‚ö° EL√âCTRICOS E INSTRUMENTACI√ìN">
              <option value="Materiales el√©ctricos">Materiales el√©ctricos</option>
              <option value="Iluminaci√≥n">Iluminaci√≥n</option>
              <option value="Conductores">Conductores</option>
              <option value="Cintas aislantes">Cintas aislantes</option>
              <option value="Elementos de protecci√≥n el√©ctrica">Elementos de protecci√≥n el√©ctrica</option>
              <option value="Amarracables">Amarracables</option>
            </optgroup>
            
            <!-- üîß HERRAMIENTAS INDUSTRIALES -->
            <optgroup label="üîß HERRAMIENTAS INDUSTRIALES">
              <option value="Herramientas manuales">Herramientas manuales</option>
              <option value="Herramientas el√©ctricas">Herramientas el√©ctricas</option>
              <option value="Herramientas inal√°mbricas">Herramientas inal√°mbricas</option>
              <option value="Instrumentos de medici√≥n">Instrumentos de medici√≥n</option>
              <option value="Almacenamiento de herramientas">Almacenamiento de herramientas</option>
              <option value="Herramientas neum√°ticas">Herramientas neum√°ticas</option>
              <option value="Otras herramientas manuales y accesorios">Otras herramientas manuales y accesorios</option>
            </optgroup>
            
            <!-- üõ†Ô∏è MRO & MISCEL√ÅNEOS -->
            <optgroup label="üõ†Ô∏è MRO & MISCEL√ÅNEOS">
              <option value="Mantenimiento y limpieza">Mantenimiento y limpieza</option>
              <option value="Ferreter√≠a industrial">Ferreter√≠a industrial</option>
              <option value="Materiales de construcci√≥n">Materiales de construcci√≥n</option>
              <option value="Abastecimiento integral">Abastecimiento integral</option>
              <option value="Equipamiento de campamentos">Equipamiento de campamentos</option>
            </optgroup>
          </select>
          <small class="form-hint">Selecciona la categor√≠a m√°s espec√≠fica para el producto</small>
        </div>

        <!-- PRECIO -->
        <div class="form-group">
          <label>Precio (S/) *</label>
          <input 
            type="number" 
            [(ngModel)]="nuevoProducto.precio"
            name="precio"
            placeholder="0.00"
            step="0.01"
            min="0"
            class="form-input"
            required>
        </div>

        <!-- STOCK -->
        <div class="form-group">
          <label>Stock *</label>
          <input 
            type="number" 
            [(ngModel)]="nuevoProducto.stock"
            name="stock"
            placeholder="0"
            min="0"
            class="form-input"
            required>
        </div>

        <!-- DESCRIPCI√ìN -->
        <div class="form-group full-width">
          <label>Descripci√≥n</label>
          <textarea 
            [(ngModel)]="nuevoProducto.descripcion"
            name="descripcion"
            placeholder="Descripci√≥n del producto..."
            class="form-textarea"
            rows="4"></textarea>
        </div>

      </form>
    </div>

    <!-- FOOTER DEL MODAL -->
    <div class="modal-footer">
      <button class="btn-secondary" (click)="cancelar()" [disabled]="cargando || subiendoImagen">
        Cancelar
      </button>
      <button 
        class="btn-primary" 
        (click)="guardarProducto()"
        [disabled]="cargando || subiendoImagen">
        <span *ngIf="!cargando && !subiendoImagen">
          {{ modoEdicion ? 'üíæ Actualizar' : '‚ûï Crear' }}
        </span>
        <span *ngIf="cargando || subiendoImagen">
          ‚è≥ {{ subiendoImagen ? 'Subiendo imagen...' : 'Guardando...' }}
        </span>
      </button>
    </div>

  </div>
</div>